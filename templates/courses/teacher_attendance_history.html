{% extends 'base.html' %}

{% block page_title %}Attendance History for {{ course.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6 text-center">Attendance History for {{ course.name }}</h1>

    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
        {% if attendance_by_student %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border-collapse">
                    <thead>
                        <tr>
                            <th class="px-4 py-2 border border-gray-300 text-left text-sm leading-4 text-gray-600 uppercase tracking-wider">Student</th>
                             {% for session in sessions %}
                                <th class="px-4 py-2 border border-gray-300 text-center text-sm leading-4 text-gray-600 uppercase tracking-wider">{{ session.date|date:"m/d" }}<br>{{ session.start_time|time:"H:i" }}</th>
                             {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for student, records in attendance_by_student.items %}
                        <tr>
                            <td class="px-4 py-2 border border-gray-300 whitespace-no-wrap font-semibold">{{ student.name }}</td>
                             {% for session in sessions %}
                                 <td class="px-4 py-2 border border-gray-300 text-center whitespace-no-wrap">
                                     {% with attendance_record=records|find_attendance_for_session:session %}
                                         {% if attendance_record %}
                                             <span class="{% if attendance_record.status == 'present' %}text-green-600{% elif attendance_record.status == 'absent' %}text-red-600{% else %}text-yellow-600{% endif %}">
                                                {{ attendance_record.status|upper|slice:":1" }} {# Display first letter of status #}
                                             </span>
                                         {% else %}
                                             - {# No attendance record for this session #}
                                         {% endif %}
                                     {% endwith %}
                                 </td>
                             {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-gray-700">No attendance records available for this course yet.</p>
        {% endif %}

        <div class="mt-6 text-center">
             <a href="{% url 'courses:teacher_course_list' %}" class="text-gray-600 hover:underline">Back to My Courses</a>
        </div>

    </div>

</div>

{# Custom filter to find attendance record for a session in a list of records #}
{% load custom_filters %}

{% endblock %} 